# Elder Brain Pipeline Bug: "No steps found in the plan"

## Summary

When running `cookbook/10_elder_brain.py`, the pipeline fails during the **Execution** phase with the error:

```
"error": "No steps found in the plan",
"phase": "plan_execution"
```

---

## Root Cause

- The `ElderBrain.execute_plan()` method **expects the plan dict to have a nested `"plan"` key** containing the `"steps"` list:

```python
steps = plan.get("plan", {}).get("steps", [])
```

- However, the actual plan dict **already contains `"steps"` at the top level**, as generated by the planning phase:

```json
{
  "plan": {
    "steps": [ ... ],
    ...
  }
}
```

- In `main()`, the plan is extracted as:

```python
plan = plan_results.get("plan", {})
```

and passed to `execute_plan()`, so the plan dict looks like:

```python
{
  "steps": [ ... ],
  ...
}
```

- Therefore, `plan.get("plan", {})` returns `{}`, and `steps` becomes an empty list.

- This triggers the error: **"No steps found in the plan"**.

---

## The Fix

In `tinyagent/factory/elder_brain.py`, inside the `execute_plan()` method, **replace:**

```python
steps = plan.get("plan", {}).get("steps", [])
```

**with:**

```python
steps = plan.get("steps", [])
```

This correctly extracts the steps list from the plan dict.

---

## Patch Diff

```diff
- steps = plan.get("plan", {}).get("steps", [])
+ steps = plan.get("steps", [])
```

---

## Testing the Fix

1. Apply the patch.
2. Run:

```bash
python3 cookbook/10_elder_brain.py
```

3. The execution phase should now process the steps instead of failing.
4. Verify that the pipeline completes all phases successfully.

---

## Additional Notes

- Consider adding validation to ensure the plan format is as expected.
- Optionally, refactor the plan structure to avoid confusion.
